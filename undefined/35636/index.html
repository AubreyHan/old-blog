<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Azure,存储," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="&amp;emsp;&amp;emsp;备份是企业IT环境中数据保护不可或缺的一个系统。传统的备份环境发展至今已经引入了很多新的元素，例如LanFree、VTL、数据消重等。随着云的兴起，备份系统的云化也逐步成为很多用户下一代备份新的选择。&amp;emsp;&amp;emsp;备份系统云化有很多不同的实施方案，例如云上云下部署两套同构备份做同步、云下部署代理云上进行备份管理等。今天聊一聊备份介质云化的方案，对客户云下的备份系统">
<meta property="og:type" content="article">
<meta property="og:title" content="备份数据何处放？云为衣兮霓为裳——浅谈备份介质云化">
<meta property="og:url" content="http://aubreyhan.net/undefined/35636/index.html">
<meta property="og:site_name" content="Reid爸的菜园子">
<meta property="og:description" content="&amp;emsp;&amp;emsp;备份是企业IT环境中数据保护不可或缺的一个系统。传统的备份环境发展至今已经引入了很多新的元素，例如LanFree、VTL、数据消重等。随着云的兴起，备份系统的云化也逐步成为很多用户下一代备份新的选择。&amp;emsp;&amp;emsp;备份系统云化有很多不同的实施方案，例如云上云下部署两套同构备份做同步、云下部署代理云上进行备份管理等。今天聊一聊备份介质云化的方案，对客户云下的备份系统">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844470100180.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844477204845.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844482029369.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844483428752.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844494378237.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844541905696.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844543810532.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844544555694.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844545631927.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844547686197.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844550058838.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844551643954.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844552494482.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844553110502.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844564173195.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844559004904.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844559680775.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844560030414.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844560566917.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844572097495.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844573123482.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844573943483.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844574741739.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844575751869.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844579139165.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844579436759.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844581480291.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844582508351.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844583309316.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844583730047.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844584013788.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844584245477.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844584932814.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844585256448.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844585533942.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844586120085.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844586257183.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844586740195.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844587075456.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844587472332.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844587978952.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844588304828.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844589002831.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844589471217.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844589965086.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844590521221.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844591253344.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844591664238.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844593339746.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844595314769.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844595933259.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844599946293.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844601492168.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844602396178.jpg">
<meta property="og:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844603011127.jpg">
<meta property="article:published_time" content="2020-03-17T06:41:08.000Z">
<meta property="article:modified_time" content="2020-04-04T02:49:41.000Z">
<meta property="article:author" content="Aubrey Han">
<meta property="article:tag" content="Azure">
<meta property="article:tag" content="存储">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyblog.blob.core.chinacloudapi.cn/blog/15844470100180.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://aubreyhan.net/undefined/35636/"/>





  <title> 备份数据何处放？云为衣兮霓为裳——浅谈备份介质云化 | Reid爸的菜园子 </title>
<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Reid爸的菜园子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">IT、技术、杂谈、牢骚、旅行、玩物，想到哪里写到哪里的杂草丛。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://aubreyhan.net/undefined/35636/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aubrey Han">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reid爸的菜园子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                备份数据何处放？云为衣兮霓为裳——浅谈备份介质云化
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-17T14:41:08+08:00">
                2020-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Azure/" itemprop="url" rel="index">
                    <span itemprop="name">Azure</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Azure/%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">存储</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>&emsp;&emsp;备份是企业IT环境中数据保护不可或缺的一个系统。传统的备份环境发展至今已经引入了很多新的元素，例如LanFree、VTL、数据消重等。随着云的兴起，备份系统的云化也逐步成为很多用户下一代备份新的选择。<br>&emsp;&emsp;备份系统云化有很多不同的实施方案，例如云上云下部署两套同构备份做同步、云下部署代理云上进行备份管理等。今天聊一聊备份介质云化的方案，对客户云下的备份系统重构的影响最小。</p>
<a id="more"></a>
<h1 id="备份系统概述"><a href="#备份系统概述" class="headerlink" title="备份系统概述"></a>备份系统概述</h1><h2 id="备份架构"><a href="#备份架构" class="headerlink" title="备份架构"></a>备份架构</h2><p>&emsp;&emsp;通常一个完整的备份系统由如下元素组成：</p>
<ul>
<li>服务器，在备份环境里通常含有如下不同角色的服务器：<ul>
<li>客户端：需要备份数据的服务器</li>
<li>管理服务器：用作备份的统一管理，包括备份设备、客户端、备份策略等管理</li>
<li>介质服务器：连接至备份设备，客户端的数据通过介质服务器写入备份设备</li>
</ul>
</li>
</ul>
<p><em>需要注意的是，这些服务器角色并不是互斥的，一台服务器可能充当多个角色，例如在小型环境里，通常管理服务器直接充当介质服务器；而在大型环境里，为了提升备份效率，客户端也会直接作为介质服务器将备份数据写入备份设备。</em></p>
<ul>
<li><p>备份线路：早期的备份系统一般直接使用以太网LAN作为备份线路，随着数据备份量越来越大，LAN已经不能满足备份需求，并且和业务混用LAN，对业务也会造成影响；所以存储光纤FC逐步成为备份线路的主流，这就是所谓的LanFree备份；但近些年备份系统开始引入源端消重等高级功能，FC很难实现，LAN又逐步回归占领备份领域；不过为了避免对业务影响，即使使用LAN，也建议和业务LAN分开，单独架设一个备份网络</p>
</li>
<li><p>备份设备：</p>
<ul>
<li>磁带：以磁带为介质的磁带机或磁带库（TL）毫无疑问是最通用的备份设备；但磁带的先天缺陷导致其逐步被淘汰</li>
<li>光盘：光盘刻录机或光盘塔昙花一现，问题太多，很快就淘汰了</li>
<li>磁盘：以磁盘为介质的盘阵、虚拟带库（VTL）在现代已经成为了近线备份的主流被大多数用户接受并使用</li>
<li>云：近些年，随着云的大规模发展，高安全性、低价格、远程访问等优势使得云在备份市场异军突起，成为新一代备份设备的主流</li>
<li>其他：还有一些小众的备份设备例如MO等，基本没有被大众市场接受</li>
</ul>
</li>
</ul>
<p>&emsp;&emsp;典型企业备份系统图如下：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844470100180.jpg" alt=""></p>
<p>&emsp;&emsp;这是一个典型的D（Data）to D（Disk）to T（Tape）架构。<br>&emsp;&emsp;磁盘设备如VTL充当一级备份，可以实现快速备份恢复，甚至在恢复的同时拉起业务，并且通过消重等技术达到数十倍于物理容量的逻辑容量。<br>&emsp;&emsp;磁盘设备虽然有很多优势，但毕竟容量有限，并且成本较高，所以只能保存短期（以周记）的备份数据，长期（以年记）的备份数据需要转储到磁带设备上，实现低廉的长时间大容量保存。并且为了避免地域性灾害，磁带可以实现离线异地保存，提高安全性。<br>&emsp;&emsp;而磁带本身存在先天缺陷，例如读写速度慢，没有数据校验机制，对保存环境要求严格（需要恒温恒湿）等，笔者从事备份行业时，基本每年都要遇到几个磁带数据不能恢复的案例，云替代磁带成为新的离线备份设备成为大势所趋，企业的备份系统图演化成如下架构：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844477204845.jpg" alt=""></p>
<p>&emsp;&emsp;相对于磁带，云（特别是公有云）有着明显的优势：读写速度快，数据完整性有保障，先天具有离线优势，方便的远程访问可实现异地恢复等</p>
<h2 id="备份设备云化方案"><a href="#备份设备云化方案" class="headerlink" title="备份设备云化方案"></a>备份设备云化方案</h2><p>&emsp;&emsp;备份设备云化在不同的厂商有不同的解决方案，以备份市场的排头兵EMC（已经是DellEMC，悲伤。。。）和Veritas为例：</p>
<ul>
<li><p>DellEMC：DellEMC本身在备份专有设备市场占有率较高，所以备份设备云化的方案是通过硬件或虚拟化的备份专有设备打通云下备份环境和云上存储的通道，通常做法是将备份专有设备作为云的缓存（CloudBoost）或直接用云充当备份专有设备的二级存储（CloudTier）实现备份上云的目标。系统架构如下：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844482029369.jpg" alt=""></p>
</li>
<li><p>Veritas：Veritas以备份软件（NBU、BE）起家，虽然也在推备份一体化设备，但软件仍为其重点，解决方案也比较简单，直接将云作为备份设备，备份数据从介质服务器写入云。架构如下：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844483428752.jpg" alt=""></p>
</li>
</ul>
<p>&emsp;&emsp;两种方式各有优劣：<br>&emsp;&emsp;通过备份专有设备的方式优势在于可以充分享有备份设备的各种高级功能例如源端消重，对到云端的链路要求比较低（设备到云是异步传输），云对备份管理是透明的，备份软件不用维护多个备份保留策略等；劣势在于需要专门的设备，对客户需要一笔额外投资（虚拟化的也需要买license），并且离开设备，数据恢复难度较大<br>&emsp;&emsp;直接备份到云的优势架构比较简单，云上备份数据是独立的，可以方便的异地恢复；劣势在于，很多基于磁盘的高级功能不能实现，备份到云时虽然有本地缓存，但如果链路质量不好，缓存被打爆会造成备份失败，并且备份系统需要维护本地和云端两套数据保留策略<br>&emsp;&emsp;具体采用什么样的备份设备云化方案要根据客户的实际业务情况。<br>&emsp;&emsp;本次Demo测试直接备份到云的方案</p>
<h1 id="备份到云测试"><a href="#备份到云测试" class="headerlink" title="备份到云测试"></a>备份到云测试</h1><p>&emsp;&emsp;测试所需要的环境：</p>
<ul>
<li>一台服务器，已经安装好NBU8.2（为了简化测试，将管理服务器、介质服务器、客户端装到同一台Windows 2016 Server），可以访问外网</li>
<li>一个Azure账号，Global或者China都可以<h2 id="Azure环境准备"><a href="#Azure环境准备" class="headerlink" title="Azure环境准备"></a>Azure环境准备</h2>&emsp;&emsp;Azure的环境准备比较简单，创建好一个存储账户即可，本次测试以Global为例，创建存储账户如下：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844494378237.jpg" alt=""></li>
</ul>
<p>&emsp;&emsp;区域、安全性等根据实际情况选择；需要注意的是访问层。在接下来的测试中可以看到，NBU对访问层有配置需求。</p>
<h2 id="NBU配置"><a href="#NBU配置" class="headerlink" title="NBU配置"></a>NBU配置</h2><p>&emsp;&emsp;在服务器打开NBU管理界面：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844541905696.jpg" alt=""></p>
<p>&emsp;&emsp;点击“Config Cloud Storage Server”将云连接到NBU：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844543810532.jpg" alt=""></p>
<p>&emsp;&emsp;点击下一步，NBU可以支持很多不同类型的云服务，或搜索Azure：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844544555694.jpg" alt=""></p>
<p>&emsp;&emsp;选择第一项（第二项是为美国政府云准备），进入Azure配置：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844545631927.jpg" alt=""></p>
<p>&emsp;&emsp;这里解释一下各选项。<br>&emsp;&emsp;“Service Host”指定使用Azure的区域。从全球来看，除了美国政府云，Azure分为三个独立部分：AzureGlobal，AzureChina，AzureGenmany。根据实际存放备份数据的位置选择不同Host（服务的Endpoint），本Demo中使用AzureGlobal，所以选择第一项：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844547686197.jpg" alt=""></p>
<p>&emsp;&emsp;“Storage Server Name”设置连接Azure的服务名，可以自定义；“Media Server Name”即介质服务器，本Demo中只有管理服务器做介质服务器，所以下拉框里只有一台供选择：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844550058838.jpg" alt=""></p>
<p>&emsp;&emsp;“Access Details for Microsoft Azure Account”里填入备份数据存放的存储账户的账户名和秘钥：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844551643954.jpg" alt=""></p>
<p>&emsp;&emsp;“Advanced Settings”里设置是否通过https传输，以及如果服务器不能直接访问外网时的Proxy设置：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844552494482.jpg" alt=""></p>
<p>&emsp;&emsp;点击下一步，进入访问层的设置（注意，这个设置在完成后不能修改）：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844553110502.jpg" alt=""></p>
<p>&emsp;&emsp;第一个选项，备份数据的访问层继承存储账户的设置<br>&emsp;&emsp;第二个选项“ARCHIVE”，要求存储账户设置为热访问层，备份数据存入后将自动转为归档：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844564173195.jpg" alt=""></p>
<p>&emsp;&emsp;这里可能会有疑惑，为什么不可以手工将数据从热层或冷层转为归档层或者通过Azure的生命周期管理定时去转？这是因为归档层的数据不能直接访问，需要先转回热层或冷层。如果在Azure端去转，NBU并不知道，需要回复时先要手工去把数据提回热层或冷层，操作较为繁琐。而让NBU自己管理，这个过程是完全自动化，简化了操作。<br>&emsp;&emsp;这里选择第一项，点击下一步，设置备份数据块的大小，写入云端是否压缩，以及是否要用AES-256加密。如果需要加密，需要架设KMS服务器。本测试保持默认即可：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844559004904.jpg" alt=""></p>
<p>&emsp;&emsp;点击下一步，忽略不加密的警告，可以看到配置的Summary：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844559680775.jpg" alt=""></p>
<p>&emsp;&emsp;点击下一步完成连接到Azure的配置：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844560030414.jpg" alt=""></p>
<p>&emsp;&emsp;再下一步配置成功页面，NBU已连接至Azure存储账户：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844560566917.jpg" alt=""></p>
<p>&emsp;&emsp;点击下一步进入DiskPool的配置：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844572097495.jpg" alt=""></p>
<p>&emsp;&emsp;点击“Add New Volumn”添加Volume，实际是向存储账户里添加容器：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844573123482.jpg" alt=""></p>
<p>&emsp;&emsp;添加完成去Azure存储账户检查，发现多出一个容器：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844573943483.jpg" alt=""></p>
<p>&emsp;&emsp;回到NBU，勾选这个Volume并下一步加入一个DiskPook；如果要避免和业务争抢带宽，可以在Limit I/O Streams设置带宽限制：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844574741739.jpg" alt=""></p>
<p>&emsp;&emsp;接着往下确认Summary后成功创建Disk Pool：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844575751869.jpg" alt=""></p>
<p>&emsp;&emsp;再下一步创建Storage Unit：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844579139165.jpg" alt=""></p>
<p>&emsp;&emsp;点击下一步创建成功：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844579436759.jpg" alt=""></p>
<p>&emsp;&emsp;到此，备份介质配置成功</p>
<h2 id="备份测试"><a href="#备份测试" class="headerlink" title="备份测试"></a>备份测试</h2><p>&emsp;&emsp;准备好一个备份的源目录，以C:\Demo为例，容量3.77GB：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844581480291.jpg" alt=""></p>
<p>&emsp;&emsp;点击NBU管理界面的Policies，右键点击服务器，选择“New Policy”<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844582508351.jpg" alt=""></p>
<p>&emsp;&emsp;为Policy起一个名字并选择用向导配置：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844583309316.jpg" alt=""></p>
<p>&emsp;&emsp;因为测试目录备份，所以选择第一项即可：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844583730047.jpg" alt=""></p>
<p>&emsp;&emsp;保持默认：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844584013788.jpg" alt=""></p>
<p>&emsp;&emsp;这里添加客户端：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844584245477.jpg" alt=""></p>
<p>&emsp;&emsp;点击Add，服务端名字写127.0.0.1，操作系统选择对应的os或者自动检查都可以：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844584932814.jpg" alt=""></p>
<p>&emsp;&emsp;点击OK后，成功添加：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844585256448.jpg" alt=""></p>
<p>&emsp;&emsp;这里选择备份的文件夹：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844585533942.jpg" alt=""></p>
<p>&emsp;&emsp;点击Add，浏览并选择C:\Demo:<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844586120085.jpg" alt=""><br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844586257183.jpg" alt=""></p>
<p>&emsp;&emsp;再下一步选择备份方式（全备、增量、是否允许user发起备份等），保持默认：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844586740195.jpg" alt=""></p>
<p>&emsp;&emsp;下一步，数据保留策略，保持默认：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844587075456.jpg" alt=""></p>
<p>&emsp;&emsp;下一步，选择备份窗口，避免影响业务，保持默认：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844587472332.jpg" alt=""></p>
<p>&emsp;&emsp;下一步，完成Policy的设置：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844587978952.jpg" alt=""></p>
<p>&emsp;&emsp;现在Policies里，已经可以看到新的Policy：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844588304828.jpg" alt=""></p>
<p>&emsp;&emsp;双击Policy进入设置，在Policy Storage里选择创建好的云存储：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844589002831.jpg" alt=""></p>
<p>&emsp;&emsp;现在右键点击Policy，可以发起On-Demand备份（Manual Backup）：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844589471217.jpg" alt=""></p>
<p>&emsp;&emsp;点击OK，开始备份：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844589965086.jpg" alt=""></p>
<p>&emsp;&emsp;点击左边菜单的Activity Monitor，可以看到任务执行情况：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844590521221.jpg" alt=""></p>
<p>&emsp;&emsp;挡小人变蓝，就是备份执行成功：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844591253344.jpg" alt=""></p>
<p>&emsp;&emsp;双击这个activity，可以查看任务的细节：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844591664238.jpg" alt=""></p>
<p>&emsp;&emsp;回到Azure的存储账户，进入NBU创建的容器里，可以看到多出了内容：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844593339746.jpg" alt=""></p>
<p>&emsp;&emsp;进入文件夹里，看到的是一个一个4MB的文件，访问层继承了存储账户的热访问层，和源目录中的文件结构并不一样，这是备份软件在备份时将文件夹做成了一个“流”，并截取成一段一段，所以不用担心云端文件的安全性，即使拿到，没有备份软件的索引数据库也无法恢复：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844595314769.jpg" alt=""></p>
<p>&emsp;&emsp;查看整个容器的容量，3.78GiB，因为没有启用压缩，与源目录大小基本一致:<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844595933259.jpg" alt=""></p>
<p>&emsp;&emsp;至此，备份完成。</p>
<h2 id="归档访问层的备份测试"><a href="#归档访问层的备份测试" class="headerlink" title="归档访问层的备份测试"></a>归档访问层的备份测试</h2><p>&emsp;&emsp;再创建一个访问层为归档的云备份介质，这里选择“ARCHIVE”：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844599946293.jpg" alt=""></p>
<p>&emsp;&emsp;其余保持一下，配置完成进行备份测试：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844601492168.jpg" alt=""></p>
<p>&emsp;&emsp;数据写入新创建的名为“acc-stu”的Storage Unit，对应到存储账户的“achivedemo”容器：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844602396178.jpg" alt=""></p>
<p>&emsp;&emsp;进入目录查看，虽然容器属于nbudemo这个默认访问层为热的存储账户，但备份的数据自动转为了归档：<br><img src="https://hyblog.blob.core.chinacloudapi.cn/blog/15844603011127.jpg" alt=""></p>
<p>&emsp;&emsp;</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>&emsp;&emsp;本次测试，验证了NBU备份到云的可行性，可以看出，NBU里使用Azure Blob作为备份介质配置非常简单，对客户现有的备份环境基本没有影响，只需要在Policy修改一下备份设备即可，可以说是最简单的无痛上云方式。<br>&emsp;&emsp;当然在具体实施时，还有一些网络、介质服务器、加密等的设置需要考虑，但对客户的长期备份数据保护，云不失为一个替代磁带的最佳解决方案。<br>&emsp;&emsp;<br>&emsp;&emsp;</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div></div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat.jpg" alt="Aubrey Han WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Azure/" rel="tag"># Azure</a>
          
            <a href="/tags/%E5%AD%98%E5%82%A8/" rel="tag"># 存储</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/undefined/16642/" rel="next" title="运筹帷幄间，决胜千里外——VS Code远程开发环境搭建">
                <i class="fa fa-chevron-left"></i> 运筹帷幄间，决胜千里外——VS Code远程开发环境搭建
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/undefined/9864/" rel="prev" title="鼠标轻点击，数据大挪移——Azure存储账户主动故障转移">
                鼠标轻点击，数据大挪移——Azure存储账户主动故障转移 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Aubrey Han" />
          <p class="site-author-name" itemprop="name">Aubrey Han</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#备份系统概述"><span class="nav-number">1.</span> <span class="nav-text">备份系统概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#备份架构"><span class="nav-number">1.1.</span> <span class="nav-text">备份架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份设备云化方案"><span class="nav-number">1.2.</span> <span class="nav-text">备份设备云化方案</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#备份到云测试"><span class="nav-number">2.</span> <span class="nav-text">备份到云测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Azure环境准备"><span class="nav-number">2.1.</span> <span class="nav-text">Azure环境准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NBU配置"><span class="nav-number">2.2.</span> <span class="nav-text">NBU配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份测试"><span class="nav-number">2.3.</span> <span class="nav-text">备份测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#归档访问层的备份测试"><span class="nav-number">2.4.</span> <span class="nav-text">归档访问层的备份测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Aubrey Han</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
